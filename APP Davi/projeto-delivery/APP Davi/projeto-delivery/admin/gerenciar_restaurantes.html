<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PedidoF√°cil - Gerenciar Restaurantes</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #f8f9fa; color: #333; }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 20px 0; position: sticky; top: 0; z-index: 100;
        }
        .header-content {
            max-width: 1400px; margin: 0 auto; padding: 0 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .back-btn { background: rgba(255,255,255,0.2); border: none; color: white;
            padding: 10px 15px; border-radius: 25px; cursor: pointer; }
        .title { font-size: 1.8rem; font-weight: bold; }
        
        .main { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        .filtros { background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 20px; margin-bottom: 20px; }
        .filtros-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .filtro-item { display: flex; flex-direction: column; }
        .filtro-label { margin-bottom: 8px; color: #333; font-weight: 600; }
        .filtro-input { padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px; }
        .filtro-input:focus { outline: none; border-color: #667eea; }
        .aplicar-filtros { background: #667eea; color: white; border: none; padding: 12px 20px;
            border-radius: 8px; cursor: pointer; font-weight: 600; margin-top: 20px; }
        
        .stats-overview { background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 25px; margin-bottom: 20px; }
        .overview-title { font-size: 1.3rem; font-weight: 600; margin-bottom: 20px; color: #333; }
        .overview-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .overview-card { background: #f8f9fa; border-radius: 10px; padding: 20px; text-align: center; }
        .overview-value { font-size: 1.8rem; font-weight: bold; color: #667eea; margin-bottom: 8px; }
        .overview-label { color: #666; font-size: 0.9rem; }
        
        .restaurants-container { background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 25px; margin-bottom: 20px; }
        .restaurants-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .restaurants-title { font-size: 1.3rem; font-weight: 600; color: #333; }
        .add-restaurant-btn { background: #28a745; color: white; border: none; padding: 10px 20px;
            border-radius: 8px; cursor: pointer; font-weight: 600; }
        
        .restaurant-item { border: 1px solid #e1e5e9; border-radius: 10px; padding: 20px; margin-bottom: 15px;
            transition: all 0.3s; }
        .restaurant-item:hover { box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .restaurant-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .restaurant-info h4 { color: #333; margin-bottom: 5px; font-size: 1.1rem; }
        .restaurant-info p { color: #666; font-size: 0.9rem; margin-bottom: 3px; }
        .restaurant-status { padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
        .status-ativo { background: #d4edda; color: #155724; }
        .status-inativo { background: #f8d7da; color: #721c24; }
        .status-pendente { background: #fff3cd; color: #856404; }
        .status-suspenso { background: #e2e3e5; color: #383d41; }
        
        .restaurant-details { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px; }
        .detail-group h5 { color: #333; margin-bottom: 5px; font-size: 0.9rem; font-weight: 600; }
        .detail-group p { color: #666; font-size: 0.8rem; }
        
        .restaurant-actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .action-btn { padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.8rem; font-weight: 600; }
        .btn-edit { background: #17a2b8; color: white; }
        .btn-suspend { background: #ffc107; color: #212529; }
        .btn-activate { background: #28a745; color: white; }
        .btn-delete { background: #dc3545; color: white; }
        .btn-view { background: #6c757d; color: white; }
        .btn-approve { background: #20c997; color: white; }
        
        .pagination { display: flex; justify-content: center; gap: 10px; margin-top: 20px; }
        .page-btn { padding: 10px 15px; border: 1px solid #e1e5e9; background: white; color: #333;
            border-radius: 6px; cursor: pointer; }
        .page-btn.active { background: #667eea; color: white; border-color: #667eea; }
        .page-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: white; margin: 5% auto; padding: 25px; border-radius: 15px;
            width: 90%; max-width: 700px; max-height: 80vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-title { font-size: 1.3rem; font-weight: 600; color: #333; }
        .close { color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover { color: #000; }
        
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; color: #333; font-weight: 600; }
        .form-input { width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px; }
        .form-input:focus { outline: none; border-color: #667eea; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        .modal-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
        .btn { padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .btn-primary { background: #667eea; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        
        .no-data { text-align: center; padding: 40px; color: #666; }
        .loading { text-align: center; padding: 40px; color: #666; }
        
        .message { position: fixed; top: 20px; right: 20px; z-index: 1000; padding: 15px 20px;
            border-radius: 10px; color: white; font-weight: 600; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .message.success { background: #28a745; }
        .message.error { background: #dc3545; }
        .message.warning { background: #ffc107; color: #212529; }
        
        .rating-stars { color: #ffc107; font-size: 1.2rem; }
        .category-badge { background: #e3f2fd; color: #1976d2; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; }
        
        @media (max-width: 768px) { .filtros-grid { grid-template-columns: 1fr; }
            .overview-grid { grid-template-columns: 1fr; } .restaurant-details { grid-template-columns: 1fr; }
            .form-row { grid-template-columns: 1fr; } .restaurant-actions { flex-direction: column; } }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <button class="back-btn" onclick="voltarParaHome()">‚Üê Voltar</button>
            <div class="title">üè™ Gerenciar Restaurantes</div>
        </div>
    </header>

    <main class="main">
        <div class="filtros">
            <div class="filtros-grid">
                <div class="filtro-item">
                    <label class="filtro-label">Status</label>
                    <select class="filtro-input" id="filtro-status">
                        <option value="">Todos os status</option>
                        <option value="ativo">Ativo</option>
                        <option value="inativo">Inativo</option>
                        <option value="pendente">Pendente</option>
                        <option value="suspenso">Suspenso</option>
                    </select>
                </div>
                
                <div class="filtro-item">
                    <label class="filtro-label">Categoria</label>
                    <select class="filtro-input" id="filtro-categoria">
                        <option value="">Todas as categorias</option>
                        <option value="pizza">Pizza</option>
                        <option value="hamburguer">Hamb√∫rguer</option>
                        <option value="japonesa">Japonesa</option>
                        <option value="chinesa">Chinesa</option>
                        <option value="brasileira">Brasileira</option>
                        <option value="italiana">Italiana</option>
                        <option value="arabe">√Årabe</option>
                        <option value="doces">Doces</option>
                        <option value="bebidas">Bebidas</option>
                    </select>
                </div>
                
                <div class="filtro-item">
                    <label class="filtro-label">Buscar</label>
                    <input type="text" class="filtro-input" id="filtro-busca" placeholder="Nome, email ou CNPJ">
                </div>
                
                <div class="filtro-item">
                    <label class="filtro-label">Ordenar por</label>
                    <select class="filtro-input" id="filtro-ordenacao">
                        <option value="dataCadastro">Data de Cadastro</option>
                        <option value="nome">Nome</option>
                        <option value="avaliacao">Avalia√ß√£o</option>
                        <option value="totalAvaliacoes">Total de Avalia√ß√µes</option>
                    </select>
                </div>
            </div>
            
            <button class="aplicar-filtros" onclick="aplicarFiltros()">üîç Aplicar Filtros</button>
        </div>

        <div class="stats-overview">
            <div class="overview-title">üìä Vis√£o Geral dos Restaurantes</div>
            <div class="overview-grid" id="overview-grid">
                <div class="loading">Carregando estat√≠sticas...</div>
            </div>
        </div>

        <div class="restaurants-container">
            <div class="restaurants-header">
                <h2 class="restaurants-title">üçΩÔ∏è Lista de Restaurantes</h2>
                <button class="add-restaurant-btn" onclick="abrirModalRestaurante()">‚ûï Adicionar Restaurante</button>
            </div>
            
            <div id="restaurants-container">
                <div class="loading">Carregando restaurantes...</div>
            </div>
            
            <div class="pagination" id="pagination" style="display: none;"></div>
        </div>
    </main>

    <!-- Modal para Adicionar/Editar Restaurante -->
    <div id="restaurantModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Adicionar Restaurante</h3>
                <span class="close" onclick="fecharModal()">&times;</span>
            </div>
            
            <form id="restaurantForm" onsubmit="salvarRestaurante(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Nome do Restaurante</label>
                        <input type="text" class="form-input" id="modal-nome" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="modal-email" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Telefone</label>
                        <input type="tel" class="form-input" id="modal-telefone" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">CNPJ</label>
                        <input type="text" class="form-input" id="modal-cnpj" required placeholder="00.000.000/0000-00">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Categoria</label>
                        <select class="form-input" id="modal-categoria" required>
                            <option value="">Selecione a categoria</option>
                            <option value="pizza">Pizza</option>
                            <option value="hamburguer">Hamb√∫rguer</option>
                            <option value="japonesa">Japonesa</option>
                            <option value="chinesa">Chinesa</option>
                            <option value="brasileira">Brasileira</option>
                            <option value="italiana">Italiana</option>
                            <option value="arabe">√Årabe</option>
                            <option value="doces">Doces</option>
                            <option value="bebidas">Bebidas</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-input" id="modal-status" required>
                            <option value="ativo">Ativo</option>
                            <option value="inativo">Inativo</option>
                            <option value="pendente">Pendente</option>
                            <option value="suspenso">Suspenso</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Endere√ßo</label>
                    <input type="text" class="form-input" id="modal-endereco" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Taxa de Entrega (R$)</label>
                        <input type="number" class="form-input" id="modal-taxa-entrega" min="0" step="0.01" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Tempo M√©dio de Preparo (min)</label>
                        <input type="number" class="form-input" id="modal-tempo-preparo" min="1" value="30">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Senha</label>
                        <input type="password" class="form-input" id="modal-senha" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Confirmar Senha</label>
                        <input type="password" class="form-input" id="modal-confirmar-senha" required>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="fecharModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary" id="saveBtn">üíæ Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "sua-api-key", authDomain: "seu-projeto.firebaseapp.com",
            projectId: "seu-projeto", storageBucket: "seu-projeto.appspot.com",
            messagingSenderId: "123456789", appId: "seu-app-id"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        let restaurantes = [];
        let restaurantesFiltrados = [];
        let restauranteEditando = null;
        let paginaAtual = 1;
        const itensPorPagina = 10;
        let unsubscribeRestaurantes = null;

        document.addEventListener('DOMContentLoaded', function() {
            verificarAutenticacao();
        });

        function verificarAutenticacao() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    db.collection('usuarios').doc(user.uid).get().then((doc) => {
                        if (doc.exists && doc.data().tipo === 'admin') {
                            currentUser = { uid: user.uid, email: user.email, ...doc.data() };
                            carregarDados();
                        } else {
                            window.location.href = 'cadastro_login_admin.html';
                        }
                    });
                } else {
                    window.location.href = 'cadastro_login_admin.html';
                }
            });
        }

        async function carregarDados() {
            try {
                await carregarRestaurantes();
                await carregarEstatisticas();
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
            }
        }

        async function carregarRestaurantes() {
            if (unsubscribeRestaurantes) {
                unsubscribeRestaurantes();
            }

            unsubscribeRestaurantes = db.collection('restaurantes')
                .orderBy('dataCadastro', 'desc')
                .onSnapshot((snapshot) => {
                    restaurantes = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    aplicarFiltros();
                }, (error) => {
                    console.error('Erro ao carregar restaurantes:', error);
                });
        }

        async function carregarEstatisticas() {
            try {
                const totalRestaurantes = restaurantes.length;
                const restaurantesAtivos = restaurantes.filter(r => r.ativo).length;
                const restaurantesPendentes = restaurantes.filter(r => r.status === 'pendente').length;
                const restaurantesSuspensos = restaurantes.filter(r => r.status === 'suspenso').length;
                const mediaAvaliacao = restaurantes.length > 0 ? 
                    restaurantes.reduce((sum, r) => sum + (r.avaliacao || 0), 0) / restaurantes.length : 0;
                const totalAvaliacoes = restaurantes.reduce((sum, r) => sum + (r.totalAvaliacoes || 0), 0);
                
                const overviewGrid = document.getElementById('overview-grid');
                overviewGrid.innerHTML = `
                    <div class="overview-card">
                        <div class="overview-value">${totalRestaurantes}</div>
                        <div class="overview-label">Total de Restaurantes</div>
                    </div>
                    <div class="overview-card">
                        <div class="overview-value">${restaurantesAtivos}</div>
                        <div class="overview-label">Restaurantes Ativos</div>
                    </div>
                    <div class="overview-card">
                        <div class="overview-value">${restaurantesPendentes}</div>
                        <div class="overview-label">Aguardando Aprova√ß√£o</div>
                    </div>
                    <div class="overview-card">
                        <div class="overview-value">${restaurantesSuspensos}</div>
                        <div class="overview-label">Suspensos</div>
                    </div>
                    <div class="overview-card">
                        <div class="overview-value">${mediaAvaliacao.toFixed(1)}</div>
                        <div class="overview-label">Avalia√ß√£o M√©dia</div>
                    </div>
                    <div class="overview-card">
                        <div class="overview-value">${totalAvaliacoes}</div>
                        <div class="overview-label">Total de Avalia√ß√µes</div>
                    </div>
                `;
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas:', error);
            }
        }

        function aplicarFiltros() {
            const status = document.getElementById('filtro-status').value;
            const categoria = document.getElementById('filtro-categoria').value;
            const busca = document.getElementById('filtro-busca').value.toLowerCase();
            const ordenacao = document.getElementById('filtro-ordenacao').value;
            
            let restaurantesFiltradosTemp = restaurantes;
            
            // Filtrar por status
            if (status) {
                restaurantesFiltradosTemp = restaurantesFiltradosTemp.filter(r => r.status === status);
            }
            
            // Filtrar por categoria
            if (categoria) {
                restaurantesFiltradosTemp = restaurantesFiltradosTemp.filter(r => r.categoria === categoria);
            }
            
            // Filtrar por busca
            if (busca) {
                restaurantesFiltradosTemp = restaurantesFiltradosTemp.filter(r => 
                    r.nome?.toLowerCase().includes(busca) ||
                    r.email?.toLowerCase().includes(busca) ||
                    r.cnpj?.includes(busca)
                );
            }
            
            // Ordenar
            restaurantesFiltradosTemp.sort((a, b) => {
                switch (ordenacao) {
                    case 'nome':
                        return (a.nome || '').localeCompare(b.nome || '');
                    case 'avaliacao':
                        return (b.avaliacao || 0) - (a.avaliacao || 0);
                    case 'totalAvaliacoes':
                        return (b.totalAvaliacoes || 0) - (a.totalAvaliacoes || 0);
                    default:
                        return (b.dataCadastro || 0) - (a.dataCadastro || 0);
                }
            });
            
            restaurantesFiltrados = restaurantesFiltradosTemp;
            paginaAtual = 1;
            exibirRestaurantes();
        }

        function exibirRestaurantes() {
            const container = document.getElementById('restaurants-container');
            
            if (restaurantesFiltrados.length === 0) {
                container.innerHTML = '<div class="no-data">Nenhum restaurante encontrado</div>';
                document.getElementById('pagination').style.display = 'none';
                return;
            }
            
            const totalPaginas = Math.ceil(restaurantesFiltrados.length / itensPorPagina);
            const inicio = (paginaAtual - 1) * itensPorPagina;
            const fim = inicio + itensPorPagina;
            const restaurantesPagina = restaurantesFiltrados.slice(inicio, fim);
            
            container.innerHTML = restaurantesPagina.map(restaurante => `
                <div class="restaurant-item">
                    <div class="restaurant-header">
                        <div class="restaurant-info">
                            <h4>${restaurante.nome || 'Nome n√£o informado'}</h4>
                            <p>üìß ${restaurante.email}</p>
                            <p>üì± ${restaurante.telefone || 'Telefone n√£o informado'}</p>
                            <p>üè™ ${getCategoriaNome(restaurante.categoria)}</p>
                        </div>
                        <div class="restaurant-status status-${restaurante.status || 'ativo'}">
                            ${getStatusNome(restaurante.status || 'ativo')}
                        </div>
                    </div>
                    
                    <div class="restaurant-details">
                        <div class="detail-group">
                            <h5>üìç Endere√ßo</h5>
                            <p>${restaurante.endereco || 'Endere√ßo n√£o informado'}</p>
                        </div>
                        
                        <div class="detail-group">
                            <h5>üÜî CNPJ</h5>
                            <p>${restaurante.cnpj || 'CNPJ n√£o informado'}</p>
                        </div>
                        
                        <div class="detail-group">
                            <h5>‚≠ê Avalia√ß√£o</h5>
                            <p>${restaurante.avaliacao ? restaurante.avaliacao.toFixed(1) : '0.0'} 
                               <span class="rating-stars">${'‚òÖ'.repeat(Math.round(restaurante.avaliacao || 0))}</span>
                               (${restaurante.totalAvaliacoes || 0} avalia√ß√µes)</p>
                        </div>
                        
                        <div class="detail-group">
                            <h5>üìÖ Data de Cadastro</h5>
                            <p>${restaurante.dataCadastro ? new Date(restaurante.dataCadastro.toDate()).toLocaleDateString('pt-BR') : 'Data n√£o informada'}</p>
                        </div>
                        
                        <div class="detail-group">
                            <h5>üöö Taxa de Entrega</h5>
                            <p>R$ ${(restaurante.taxaEntrega || 0).toFixed(2)}</p>
                        </div>
                        
                        <div class="detail-group">
                            <h5>‚è±Ô∏è Tempo de Preparo</h5>
                            <p>${restaurante.tempoMedioPreparo || 30} minutos</p>
                        </div>
                    </div>
                    
                    <div class="restaurant-actions">
                        <button class="action-btn btn-view" onclick="verRestaurante('${restaurante.id}')">üëÅÔ∏è Ver</button>
                        <button class="action-btn btn-edit" onclick="editarRestaurante('${restaurante.id}')">‚úèÔ∏è Editar</button>
                        ${restaurante.status === 'pendente' ? 
                            `<button class="action-btn btn-approve" onclick="aprovarRestaurante('${restaurante.id}')">‚úÖ Aprovar</button>` : ''
                        }
                        ${restaurante.status === 'ativo' ? 
                            `<button class="action-btn btn-suspend" onclick="alterarStatus('${restaurante.id}', 'suspenso')">‚è∏Ô∏è Suspender</button>` :
                            `<button class="action-btn btn-activate" onclick="alterarStatus('${restaurante.id}', 'ativo')">‚úÖ Ativar</button>`
                        }
                        <button class="action-btn btn-delete" onclick="deletarRestaurante('${restaurante.id}')">üóëÔ∏è Deletar</button>
                    </div>
                </div>
            `).join('');
            
            // Exibir pagina√ß√£o
            if (totalPaginas > 1) {
                exibirPaginacao(totalPaginas);
            } else {
                document.getElementById('pagination').style.display = 'none';
            }
        }

        function exibirPaginacao(totalPaginas) {
            const pagination = document.getElementById('pagination');
            pagination.style.display = 'flex';
            
            let paginacaoHTML = '';
            
            if (paginaAtual > 1) {
                paginacaoHTML += `<button class="page-btn" onclick="mudarPagina(${paginaAtual - 1})">‚Üê Anterior</button>`;
            }
            
            for (let i = 1; i <= totalPaginas; i++) {
                if (i === paginaAtual) {
                    paginacaoHTML += `<button class="page-btn active">${i}</button>`;
                } else {
                    paginacaoHTML += `<button class="page-btn" onclick="mudarPagina(${i})">${i}</button>`;
                }
            }
            
            if (paginaAtual < totalPaginas) {
                paginacaoHTML += `<button class="page-btn" onclick="mudarPagina(${paginaAtual + 1})">Pr√≥xima ‚Üí</button>`;
            }
            
            pagination.innerHTML = paginacaoHTML;
        }

        function mudarPagina(pagina) {
            paginaAtual = pagina;
            exibirRestaurantes();
        }

        function getCategoriaNome(categoria) {
            const categorias = {
                'pizza': 'Pizza',
                'hamburguer': 'Hamb√∫rguer',
                'japonesa': 'Japonesa',
                'chinesa': 'Chinesa',
                'brasileira': 'Brasileira',
                'italiana': 'Italiana',
                'arabe': '√Årabe',
                'doces': 'Doces',
                'bebidas': 'Bebidas'
            };
            return categorias[categoria] || categoria || 'N√£o informada';
        }

        function getStatusNome(status) {
            switch (status) {
                case 'ativo': return 'Ativo';
                case 'inativo': return 'Inativo';
                case 'pendente': return 'Pendente';
                case 'suspenso': return 'Suspenso';
                default: return 'Ativo';
            }
        }

        function abrirModalRestaurante() {
            restauranteEditando = null;
            document.getElementById('modalTitle').textContent = 'Adicionar Restaurante';
            document.getElementById('restaurantForm').reset();
            document.getElementById('restaurantModal').style.display = 'block';
        }

        function fecharModal() {
            document.getElementById('restaurantModal').style.display = 'none';
            restauranteEditando = null;
        }

        async function salvarRestaurante(event) {
            event.preventDefault();
            
            const btn = document.getElementById('saveBtn');
            btn.disabled = true;
            btn.textContent = 'üîÑ Salvando...';
            
            try {
                const dados = {
                    nome: document.getElementById('modal-nome').value,
                    email: document.getElementById('modal-email').value,
                    telefone: document.getElementById('modal-telefone').value,
                    cnpj: document.getElementById('modal-cnpj').value,
                    categoria: document.getElementById('modal-categoria').value,
                    endereco: document.getElementById('modal-endereco').value,
                    status: document.getElementById('modal-status').value,
                    taxaEntrega: parseFloat(document.getElementById('modal-taxa-entrega').value) || 0,
                    tempoMedioPreparo: parseInt(document.getElementById('modal-tempo-preparo').value) || 30,
                    dataAtualizacao: new Date()
                };
                
                if (restauranteEditando) {
                    // Editar restaurante existente
                    await db.collection('restaurantes').doc(restauranteEditando.id).update(dados);
                    await db.collection('usuarios').doc(restauranteEditando.id).update(dados);
                    mostrarMensagem('Restaurante atualizado com sucesso!', 'success');
                } else {
                    // Criar novo restaurante
                    const senha = document.getElementById('modal-senha').value;
                    const confirmarSenha = document.getElementById('modal-confirmar-senha').value;
                    
                    if (senha !== confirmarSenha) {
                        mostrarMensagem('As senhas n√£o coincidem', 'error');
                        return;
                    }
                    
                    // Criar usu√°rio no Firebase Auth
                    const userCredential = await auth.createUserWithEmailAndPassword(dados.email, senha);
                    const user = userCredential.user;
                    
                    // Salvar dados no Firestore
                    dados.uid = user.uid;
                    dados.dataCadastro = new Date();
                    dados.ativo = dados.status === 'ativo';
                    dados.avaliacao = 0;
                    dados.totalAvaliacoes = 0;
                    
                    await db.collection('usuarios').doc(user.uid).set({
                        ...dados,
                        tipo: 'restaurante'
                    });
                    
                    await db.collection('restaurantes').doc(user.uid).set(dados);
                    
                    mostrarMensagem('Restaurante criado com sucesso!', 'success');
                }
                
                fecharModal();
                
            } catch (error) {
                console.error('Erro ao salvar restaurante:', error);
                mostrarMensagem('Erro ao salvar restaurante: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'üíæ Salvar';
            }
        }

        async function editarRestaurante(restauranteId) {
            const restaurante = restaurantes.find(r => r.id === restauranteId);
            if (!restaurante) return;
            
            restauranteEditando = restaurante;
            document.getElementById('modalTitle').textContent = 'Editar Restaurante';
            
            // Preencher formul√°rio
            document.getElementById('modal-nome').value = restaurante.nome || '';
            document.getElementById('modal-email').value = restaurante.email || '';
            document.getElementById('modal-telefone').value = restaurante.telefone || '';
            document.getElementById('modal-cnpj').value = restaurante.cnpj || '';
            document.getElementById('modal-categoria').value = restaurante.categoria || '';
            document.getElementById('modal-endereco').value = restaurante.endereco || '';
            document.getElementById('modal-status').value = restaurante.status || 'ativo';
            document.getElementById('modal-taxa-entrega').value = restaurante.taxaEntrega || 0;
            document.getElementById('modal-tempo-preparo').value = restaurante.tempoMedioPreparo || 30;
            
            // Ocultar campos de senha para edi√ß√£o
            document.getElementById('modal-senha').parentNode.style.display = 'none';
            document.getElementById('modal-confirmar-senha').parentNode.style.display = 'none';
            
            document.getElementById('restaurantModal').style.display = 'block';
        }

        async function aprovarRestaurante(restauranteId) {
            try {
                await db.collection('restaurantes').doc(restauranteId).update({
                    status: 'ativo',
                    ativo: true,
                    dataAtualizacao: new Date()
                });
                
                await db.collection('usuarios').doc(restauranteId).update({
                    status: 'ativo',
                    ativo: true,
                    dataAtualizacao: new Date()
                });
                
                mostrarMensagem('Restaurante aprovado com sucesso!', 'success');
                
            } catch (error) {
                console.error('Erro ao aprovar restaurante:', error);
                mostrarMensagem('Erro ao aprovar restaurante', 'error');
            }
        }

        async function alterarStatus(restauranteId, novoStatus) {
            try {
                await db.collection('restaurantes').doc(restauranteId).update({
                    status: novoStatus,
                    ativo: novoStatus === 'ativo',
                    dataAtualizacao: new Date()
                });
                
                await db.collection('usuarios').doc(restauranteId).update({
                    status: novoStatus,
                    ativo: novoStatus === 'ativo',
                    dataAtualizacao: new Date()
                });
                
                mostrarMensagem(`Status alterado para ${getStatusNome(novoStatus)}`, 'success');
                
            } catch (error) {
                console.error('Erro ao alterar status:', error);
                mostrarMensagem('Erro ao alterar status', 'error');
            }
        }

        async function deletarRestaurante(restauranteId) {
            if (!confirm('Tem certeza que deseja deletar este restaurante? Esta a√ß√£o n√£o pode ser desfeita.')) {
                return;
            }
            
            try {
                await db.collection('restaurantes').doc(restauranteId).delete();
                await db.collection('usuarios').doc(restauranteId).delete();
                mostrarMensagem('Restaurante deletado com sucesso!', 'success');
                
            } catch (error) {
                console.error('Erro ao deletar restaurante:', error);
                mostrarMensagem('Erro ao deletar restaurante', 'error');
            }
        }

        function verRestaurante(restauranteId) {
            const restaurante = restaurantes.find(r => r.id === restauranteId);
            if (!restaurante) return;
            
            alert(`Detalhes do Restaurante:\n\nNome: ${restaurante.nome}\nEmail: ${restaurante.email}\nCNPJ: ${restaurante.cnpj}\nCategoria: ${getCategoriaNome(restaurante.categoria)}\nStatus: ${getStatusNome(restaurante.status)}\nEndere√ßo: ${restaurante.endereco}\nAvalia√ß√£o: ${restaurante.avaliacao ? restaurante.avaliacao.toFixed(1) : '0.0'} (${restaurante.totalAvaliacoes || 0} avalia√ß√µes)\nTaxa de Entrega: R$ ${(restaurante.taxaEntrega || 0).toFixed(2)}\nTempo de Preparo: ${restaurante.tempoMedioPreparo || 30} minutos\nData de Cadastro: ${restaurante.dataCadastro ? new Date(restaurante.dataCadastro.toDate()).toLocaleDateString('pt-BR') : 'N/A'}`);
        }

        function mostrarMensagem(texto, tipo) {
            const mensagem = document.createElement('div');
            mensagem.className = `message ${tipo}`;
            mensagem.textContent = texto;
            
            document.body.appendChild(mensagem);
            
            setTimeout(() => {
                if (mensagem.parentNode) {
                    mensagem.remove();
                }
            }, 3000);
        }

        function voltarParaHome() {
            if (unsubscribeRestaurantes) {
                unsubscribeRestaurantes();
            }
            window.location.href = 'home_admin.html';
        }

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const modal = document.getElementById('restaurantModal');
            if (event.target === modal) {
                fecharModal();
            }
        }
    </script>
</body>
</html>
