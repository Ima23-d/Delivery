<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Busca - PedidoF√°cil</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-title {
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .test-result {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .test-error {
            background: #ffebee;
            border: 1px solid #f44336;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .test-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #5a6fd8;
        }
        .btn-danger {
            background: #dc3545;
        }
        .btn-danger:hover {
            background: #c82333;
        }
        .restaurant-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background: #f9f9f9;
        }
        .restaurant-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            background: white;
            margin: 5px 0;
            border-radius: 5px;
        }
        .restaurant-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste de Funcionalidade - PedidoF√°cil</h1>
    
    <div class="test-section">
        <h2 class="test-title">1. Teste de Conex√£o Firebase</h2>
        <button class="btn" onclick="testarFirebase()">Testar Conex√£o Firebase</button>
        <div id="firebase-result"></div>
    </div>

    <div class="test-section">
        <h2 class="test-title">2. Teste de Restaurantes</h2>
        <button class="btn" onclick="testarRestaurantes()">Carregar Restaurantes</button>
        <button class="btn btn-danger" onclick="limparRestaurantes()">Limpar Restaurantes</button>
        <div id="restaurantes-result"></div>
        <div id="restaurantes-lista" class="restaurant-list"></div>
    </div>

    <div class="test-section">
        <h2 class="test-title">3. Teste de Busca</h2>
        <input type="text" id="test-search" placeholder="Digite para testar a busca..." style="padding: 10px; width: 300px; margin-right: 10px;">
        <button class="btn" onclick="testarBusca()">Testar Busca</button>
        <button class="btn" onclick="limparBusca()">Limpar Busca</button>
        <div id="busca-result"></div>
    </div>

    <div class="test-section">
        <h2 class="test-title">4. Teste de Filtros</h2>
        <button class="btn" onclick="testarFiltro('pizza')">Filtrar Pizza</button>
        <button class="btn" onclick="testarFiltro('hamburguer')">Filtrar Hamb√∫rguer</button>
        <button class="btn" onclick="testarFiltro('japones')">Filtrar Japon√™s</button>
        <button class="btn" onclick="testarFiltro('todos')">Mostrar Todos</button>
        <div id="filtro-result"></div>
    </div>

    <div class="test-section">
        <h2 class="test-title">5. Status Geral</h2>
        <div id="status-geral"></div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

    <script>
        // Configura√ß√£o do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDQ6IxIEGg1pYibe8zJ_DQO2bnWa0Beng0",
            authDomain: "appdelivery-38949.firebaseapp.com",
            projectId: "appdelivery-38949",
            storageBucket: "appdelivery-38949.firebasestorage.app",
            messagingSenderId: "717102909889",
            appId: "1:717102909889:web:581ee8f19f6f3c68cb4740"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let restaurantes = [];
        let restaurantesFiltrados = [];

        // Testar conex√£o Firebase
        async function testarFirebase() {
            const resultDiv = document.getElementById('firebase-result');
            try {
                resultDiv.innerHTML = '<div class="test-info">Testando conex√£o...</div>';
                
                // Testar se consegue acessar o Firestore
                const testDoc = await db.collection('test').doc('connection').get();
                
                resultDiv.innerHTML = '<div class="test-result">‚úÖ Firebase conectado com sucesso!</div>';
                atualizarStatus();
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-error">‚ùå Erro na conex√£o Firebase: ${error.message}</div>`;
                console.error('Erro Firebase:', error);
            }
        }

        // Testar carregamento de restaurantes
        async function testarRestaurantes() {
            const resultDiv = document.getElementById('restaurantes-result');
            const listaDiv = document.getElementById('restaurantes-lista');
            
            try {
                resultDiv.innerHTML = '<div class="test-info">Carregando restaurantes...</div>';
                
                const restaurantesRef = await db.collection('restaurantes')
                    .where('ativo', '==', true)
                    .get();
                
                if (restaurantesRef.empty) {
                    resultDiv.innerHTML = '<div class="test-info">‚ÑπÔ∏è Nenhum restaurante encontrado. Criando restaurantes de exemplo...</div>';
                    await criarRestaurantesExemplo();
                    // Tentar carregar novamente
                    const restaurantesRef2 = await db.collection('restaurantes')
                        .where('ativo', '==', true)
                        .get();
                    restaurantes = restaurantesRef2.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                } else {
                    restaurantes = restaurantesRef.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                }
                
                restaurantesFiltrados = [...restaurantes];
                
                resultDiv.innerHTML = `<div class="test-result">‚úÖ ${restaurantes.length} restaurantes carregados com sucesso!</div>`;
                exibirListaRestaurantes();
                atualizarStatus();
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-error">‚ùå Erro ao carregar restaurantes: ${error.message}</div>`;
                console.error('Erro restaurantes:', error);
            }
        }

        // Criar restaurantes de exemplo
        async function criarRestaurantesExemplo() {
            const restaurantesExemplo = [
                {
                    nome: "Pizza Express",
                    categoria: "pizza",
                    descricao: "As melhores pizzas da cidade",
                    avaliacao: 4.5,
                    taxaEntrega: 5.00,
                    tempoEntrega: "30-45",
                    endereco: "Rua das Flores, 123 - Centro",
                    ativo: true
                },
                {
                    nome: "Burger House",
                    categoria: "hamburguer",
                    descricao: "Hamb√∫rgueres artesanais",
                    avaliacao: 4.3,
                    taxaEntrega: 4.50,
                    tempoEntrega: "25-35",
                    endereco: "Av. Principal, 456 - Jardins",
                    ativo: true
                },
                {
                    nome: "Sushi Master",
                    categoria: "japones",
                    descricao: "Sushi tradicional",
                    avaliacao: 4.7,
                    taxaEntrega: 6.00,
                    tempoEntrega: "35-50",
                    endereco: "Rua do Com√©rcio, 789 - Vila Madalena",
                    ativo: true
                }
            ];

            for (const restaurante of restaurantesExemplo) {
                await db.collection('restaurantes').add({
                    ...restaurante,
                    dataCadastro: new Date(),
                    dataAtualizacao: new Date()
                });
            }
        }

        // Exibir lista de restaurantes
        function exibirListaRestaurantes() {
            const listaDiv = document.getElementById('restaurantes-lista');
            if (restaurantesFiltrados.length === 0) {
                listaDiv.innerHTML = '<p>Nenhum restaurante para exibir</p>';
                return;
            }
            
            const html = restaurantesFiltrados.map(r => `
                <div class="restaurant-item">
                    <strong>${r.nome}</strong> - ${r.categoria}<br>
                    <small>‚≠ê ${r.avaliacao || 'N/A'} | üöö R$ ${r.taxaEntrega || '0.00'} | ‚è±Ô∏è ${r.tempoEntrega || 'N/A'}</small>
                </div>
            `).join('');
            
            listaDiv.innerHTML = html;
        }

        // Limpar restaurantes
        function limparRestaurantes() {
            restaurantes = [];
            restaurantesFiltrados = [];
            document.getElementById('restaurantes-result').innerHTML = '<div class="test-info">Restaurantes limpos da mem√≥ria</div>';
            document.getElementById('restaurantes-lista').innerHTML = '';
            atualizarStatus();
        }

        // Testar busca
        function testarBusca() {
            const termo = document.getElementById('test-search').value.toLowerCase().trim();
            const resultDiv = document.getElementById('busca-result');
            
            if (!termo) {
                resultDiv.innerHTML = '<div class="test-info">‚ÑπÔ∏è Digite um termo para buscar</div>';
                return;
            }
            
            const resultados = restaurantes.filter(r => 
                r.nome.toLowerCase().includes(termo) ||
                r.categoria.toLowerCase().includes(termo) ||
                (r.descricao && r.descricao.toLowerCase().includes(termo))
            );
            
            restaurantesFiltrados = resultados;
            
            if (resultados.length === 0) {
                resultDiv.innerHTML = `<div class="test-info">üîç Nenhum resultado encontrado para "${termo}"</div>`;
            } else {
                resultDiv.innerHTML = `<div class="test-result">üîç ${resultados.length} resultado(s) encontrado(s) para "${termo}"</div>`;
            }
            
            exibirListaRestaurantes();
            atualizarStatus();
        }

        // Limpar busca
        function limparBusca() {
            document.getElementById('test-search').value = '';
            restaurantesFiltrados = [...restaurantes];
            document.getElementById('busca-result').innerHTML = '<div class="test-info">Busca limpa</div>';
            exibirListaRestaurantes();
            atualizarStatus();
        }

        // Testar filtros
        function testarFiltro(categoria) {
            const resultDiv = document.getElementById('filtro-result');
            
            if (categoria === 'todos') {
                restaurantesFiltrados = [...restaurantes];
                resultDiv.innerHTML = '<div class="test-result">‚úÖ Mostrando todos os restaurantes</div>';
            } else {
                restaurantesFiltrados = restaurantes.filter(r => 
                    r.categoria.toLowerCase().includes(categoria.toLowerCase())
                );
                resultDiv.innerHTML = `<div class="test-result">‚úÖ Filtrado por categoria: ${categoria} (${restaurantesFiltrados.length} resultado(s))</div>`;
            }
            
            exibirListaRestaurantes();
            atualizarStatus();
        }

        // Atualizar status geral
        function atualizarStatus() {
            const statusDiv = document.getElementById('status-geral');
            statusDiv.innerHTML = `
                <div class="test-info">
                    <strong>Status Atual:</strong><br>
                    ‚Ä¢ Total de restaurantes: ${restaurantes.length}<br>
                    ‚Ä¢ Restaurantes filtrados: ${restaurantesFiltrados.length}<br>
                    ‚Ä¢ Firebase conectado: ${firebase.apps.length > 0 ? '‚úÖ Sim' : '‚ùå N√£o'}<br>
                    ‚Ä¢ Timestamp: ${new Date().toLocaleString('pt-BR')}
                </div>
            `;
        }

        // Inicializar p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            atualizarStatus();
        });
    </script>
</body>
</html>
