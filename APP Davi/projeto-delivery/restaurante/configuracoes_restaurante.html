<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PedidoF√°cil - Configura√ß√µes</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #f8f9fa; color: #333; }
        
        .header {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white; padding: 20px 0; position: sticky; top: 0; z-index: 100;
        }
        .header-content {
            max-width: 800px; margin: 0 auto; padding: 0 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .back-btn { background: rgba(255,255,255,0.2); border: none; color: white;
            padding: 10px 15px; border-radius: 25px; cursor: pointer; }
        .title { font-size: 1.8rem; font-weight: bold; }
        .save-btn { background: rgba(39, 174, 96, 0.8); border: none; color: white;
            padding: 10px 15px; border-radius: 25px; cursor: pointer; font-weight: 600; }
        
        .main { max-width: 800px; margin: 0 auto; padding: 20px; }
        
        .config-section {
            background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px; overflow: hidden;
        }
        .section-header { background: #3498db; color: white; padding: 20px; text-align: center; }
        .section-content { padding: 30px; }
        
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; color: #333; font-weight: 600; }
        .form-input { width: 100%; padding: 15px; border: 2px solid #e1e5e9; border-radius: 10px;
            font-size: 16px; transition: border-color 0.3s ease; }
        .form-input:focus { outline: none; border-color: #3498db; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        .horario-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .horario-item { background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center; }
        .horario-dia { font-weight: 600; margin-bottom: 15px; color: #333; }
        .horario-toggle { margin-bottom: 15px; }
        .toggle-switch { position: relative; width: 60px; height: 30px; background: #ccc;
            border-radius: 30px; cursor: pointer; transition: background 0.3s ease; margin: 0 auto; }
        .toggle-switch.active { background: #3498db; }
        .toggle-switch::after { content: ''; position: absolute; top: 3px; left: 3px;
            width: 24px; height: 24px; background: white; border-radius: 50%;
            transition: transform 0.3s ease; }
        .toggle-switch.active::after { transform: translateX(30px); }
        .horario-inputs { display: flex; gap: 10px; justify-content: center; align-items: center; }
        .horario-input { padding: 8px; border: 1px solid #e1e5e9; border-radius: 5px; width: 80px; }
        
        .message { padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center; }
        .message.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .message.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        
        @media (max-width: 768px) { .form-row { grid-template-columns: 1fr; }
            .horario-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <button class="back-btn" onclick="voltarParaHome()">‚Üê Voltar</button>
            <div class="title">‚öôÔ∏è Configura√ß√µes</div>
            <button class="save-btn" onclick="salvarConfiguracoes()" id="save-btn" style="display: none;">üíæ Salvar</button>
        </div>
    </header>

    <main class="main">
        <div class="config-section">
            <div class="section-header">
                <h2>üïí Hor√°rio de Funcionamento</h2>
                <p>Configure quando seu restaurante estar√° aberto</p>
            </div>
            <div class="section-content">
                <div class="horario-grid" id="horario-grid">
                    <!-- Hor√°rios ser√£o carregados dinamicamente -->
                </div>
            </div>
        </div>

        <div class="config-section">
            <div class="section-header">
                <h2>üí∞ Configura√ß√µes de Pre√ßo</h2>
                <p>Defina taxas e valores</p>
            </div>
            <div class="section-content">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="taxa-entrega">Taxa de Entrega (R$)</label>
                        <input type="number" class="form-input" id="taxa-entrega" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="tempo-preparo">Tempo M√©dio de Preparo (min)</label>
                        <input type="number" class="form-input" id="tempo-preparo" min="1" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="pedido-minimo">Pedido M√≠nimo (R$)</label>
                    <input type="number" class="form-input" id="pedido-minimo" step="0.01" min="0" required>
                </div>
            </div>
        </div>

        <div class="config-section">
            <div class="section-header">
                <h2>üîî Notifica√ß√µes</h2>
                <p>Configure suas prefer√™ncias de notifica√ß√£o</p>
            </div>
            <div class="section-content">
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="notif-novos-pedidos" style="margin-right: 10px;">
                        Notificar sobre novos pedidos
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="notif-cancelamentos" style="margin-right: 10px;">
                        Notificar sobre cancelamentos
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="notif-avaliacoes" style="margin-right: 10px;">
                        Notificar sobre novas avalia√ß√µes
                    </label>
                </div>
            </div>
        </div>
    </main>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "sua-api-key", authDomain: "seu-projeto.firebaseapp.com",
            projectId: "seu-projeto", storageBucket: "seu-projeto.appspot.com",
            messagingSenderId: "123456789", appId: "seu-app-id"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        let configuracoes = {};
        let dadosOriginais = {};

        document.addEventListener('DOMContentLoaded', function() {
            verificarAutenticacao();
            configurarFormulario();
        });

        function verificarAutenticacao() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    db.collection('usuarios').doc(user.uid).get().then((doc) => {
                        if (doc.exists && doc.data().tipo === 'restaurante') {
                            currentUser = { uid: user.uid, email: user.email, ...doc.data() };
                            carregarConfiguracoes();
                        } else {
                            window.location.href = 'cadastro_login_restaurante.html';
                        }
                    });
                } else {
                    window.location.href = 'cadastro_login_restaurante.html';
                }
            });
        }

        async function carregarConfiguracoes() {
            if (!currentUser) return;

            try {
                const restauranteDoc = await db.collection('restaurantes').doc(currentUser.uid).get();
                if (restauranteDoc.exists) {
                    configuracoes = restauranteDoc.data();
                    exibirHorarios();
                    preencherFormulario();
                    dadosOriginais = { ...configuracoes };
                }
            } catch (error) {
                console.error('Erro ao carregar configura√ß√µes:', error);
            }
        }

        function exibirHorarios() {
            const horarios = configuracoes.horarioFuncionamento || {};
            const dias = [
                { key: 'segunda', nome: 'Segunda-feira', icone: '1Ô∏è‚É£' },
                { key: 'terca', nome: 'Ter√ßa-feira', icone: '2Ô∏è‚É£' },
                { key: 'quarta', nome: 'Quarta-feira', icone: '3Ô∏è‚É£' },
                { key: 'quinta', nome: 'Quinta-feira', icone: '4Ô∏è‚É£' },
                { key: 'sexta', nome: 'Sexta-feira', icone: '5Ô∏è‚É£' },
                { key: 'sabado', nome: 'S√°bado', icone: '6Ô∏è‚É£' },
                { key: 'domingo', nome: 'Domingo', icone: '7Ô∏è‚É£' }
            ];

            const grid = document.getElementById('horario-grid');
            grid.innerHTML = dias.map(dia => {
                const horario = horarios[dia.key] || { aberto: false, inicio: '08:00', fim: '18:00' };
                return `
                    <div class="horario-item">
                        <div class="horario-dia">${dia.icone} ${dia.nome}</div>
                        <div class="horario-toggle">
                            <div class="toggle-switch ${horario.aberto ? 'active' : ''}" 
                                 onclick="toggleHorario('${dia.key}')"></div>
                        </div>
                        <div class="horario-inputs">
                            <input type="time" class="horario-input" id="inicio-${dia.key}" 
                                   value="${horario.inicio}" onchange="atualizarHorario('${dia.key}')">
                            <span>at√©</span>
                            <input type="time" class="horario-input" id="fim-${dia.key}" 
                                   value="${horario.fim}" onchange="atualizarHorario('${dia.key}')">
                        </div>
                    </div>
                `;
            }).join('');
        }

        function toggleHorario(dia) {
            const horario = configuracoes.horarioFuncionamento?.[dia] || { aberto: false, inicio: '08:00', fim: '18:00' };
            horario.aberto = !horario.aberto;
            
            if (!configuracoes.horarioFuncionamento) {
                configuracoes.horarioFuncionamento = {};
            }
            configuracoes.horarioFuncionamento[dia] = horario;
            
            exibirHorarios();
            verificarAlteracoes();
        }

        function atualizarHorario(dia) {
            const inicio = document.getElementById(`inicio-${dia}`).value;
            const fim = document.getElementById(`fim-${dia}`).value;
            
            if (!configuracoes.horarioFuncionamento) {
                configuracoes.horarioFuncionamento = {};
            }
            if (!configuracoes.horarioFuncionamento[dia]) {
                configuracoes.horarioFuncionamento[dia] = { aberto: false, inicio: '08:00', fim: '18:00' };
            }
            
            configuracoes.horarioFuncionamento[dia].inicio = inicio;
            configuracoes.horarioFuncionamento[dia].fim = fim;
            
            verificarAlteracoes();
        }

        function preencherFormulario() {
            document.getElementById('taxa-entrega').value = configuracoes.taxaEntrega || 0;
            document.getElementById('tempo-preparo').value = configuracoes.tempoMedioPreparo || 30;
            document.getElementById('pedido-minimo').value = configuracoes.pedidoMinimo || 0;
            
            document.getElementById('notif-novos-pedidos').checked = configuracoes.notifNovosPedidos !== false;
            document.getElementById('notif-cancelamentos').checked = configuracoes.notifCancelamentos !== false;
            document.getElementById('notif-avaliacoes').checked = configuracoes.notifAvaliacoes !== false;
        }

        function configurarFormulario() {
            const campos = ['taxa-entrega', 'tempo-preparo', 'pedido-minimo'];
            campos.forEach(campo => {
                document.getElementById(campo).addEventListener('input', verificarAlteracoes);
            });
            
            const checkboxes = ['notif-novos-pedidos', 'notif-cancelamentos', 'notif-avaliacoes'];
            checkboxes.forEach(checkbox => {
                document.getElementById(checkbox).addEventListener('change', verificarAlteracoes);
            });
        }

        function verificarAlteracoes() {
            const taxaEntrega = parseFloat(document.getElementById('taxa-entrega').value);
            const tempoPreparo = parseInt(document.getElementById('tempo-preparo').value);
            const pedidoMinimo = parseFloat(document.getElementById('pedido-minimo').value);
            const notifNovosPedidos = document.getElementById('notif-novos-pedidos').checked;
            const notifCancelamentos = document.getElementById('notif-cancelamentos').checked;
            const notifAvaliacoes = document.getElementById('notif-avaliacoes').checked;

            const alteracoes = 
                taxaEntrega !== (dadosOriginais.taxaEntrega || 0) ||
                tempoPreparo !== (dadosOriginais.tempoMedioPreparo || 30) ||
                pedidoMinimo !== (dadosOriginais.pedidoMinimo || 0) ||
                notifNovosPedidos !== (dadosOriginais.notifNovosPedidos !== false) ||
                notifCancelamentos !== (dadosOriginais.notifCancelamentos !== false) ||
                notifAvaliacoes !== (dadosOriginais.notifAvaliacoes !== false) ||
                JSON.stringify(configuracoes.horarioFuncionamento) !== JSON.stringify(dadosOriginais.horarioFuncionamento);

            document.getElementById('save-btn').style.display = alteracoes ? 'block' : 'none';
        }

        async function salvarConfiguracoes() {
            const btn = document.getElementById('save-btn');
            btn.disabled = true;
            btn.textContent = 'üîÑ Salvando...';

            try {
                const dados = {
                    taxaEntrega: parseFloat(document.getElementById('taxa-entrega').value),
                    tempoMedioPreparo: parseInt(document.getElementById('tempo-preparo').value),
                    pedidoMinimo: parseFloat(document.getElementById('pedido-minimo').value),
                    notifNovosPedidos: document.getElementById('notif-novos-pedidos').checked,
                    notifCancelamentos: document.getElementById('notif-cancelamentos').checked,
                    notifAvaliacoes: document.getElementById('notif-avaliacoes').checked,
                    horarioFuncionamento: configuracoes.horarioFuncionamento,
                    dataAtualizacao: new Date()
                };

                await db.collection('restaurantes').doc(currentUser.uid).update(dados);
                await db.collection('usuarios').doc(currentUser.uid).update(dados);

                configuracoes = { ...configuracoes, ...dados };
                dadosOriginais = { ...dados };
                verificarAlteracoes();
                mostrarMensagem('Configura√ß√µes salvas com sucesso!', 'success');

            } catch (error) {
                console.error('Erro ao salvar configura√ß√µes:', error);
                mostrarMensagem('Erro ao salvar configura√ß√µes', 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'üíæ Salvar';
            }
        }

        function mostrarMensagem(texto, tipo) {
            const mensagem = document.createElement('div');
            mensagem.className = `message ${tipo}`;
            mensagem.textContent = texto;
            document.querySelector('.main').insertBefore(mensagem, document.querySelector('.main').firstChild);
            setTimeout(() => mensagem.remove(), 5000);
        }

        function voltarParaHome() {
            window.location.href = 'home_restaurante.html';
        }
    </script>
</body>
</html>
