<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PedidoF√°cil - Detalhes do Pedido</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #f8f9fa; color: #333; }
        
        .header {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white; padding: 20px 0; position: sticky; top: 0; z-index: 100;
        }
        .header-content {
            max-width: 800px; margin: 0 auto; padding: 0 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .back-btn { background: rgba(255,255,255,0.2); border: none; color: white;
            padding: 10px 15px; border-radius: 25px; cursor: pointer; }
        .title { font-size: 1.8rem; font-weight: bold; }
        
        .main { max-width: 800px; margin: 0 auto; padding: 20px; }
        
        .order-section {
            background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px; overflow: hidden;
        }
        .section-header { background: #e67e22; color: white; padding: 20px; text-align: center; }
        .section-content { padding: 30px; }
        
        .order-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .info-item { text-align: center; padding: 20px; background: #f8f9fa; border-radius: 10px; }
        .info-icon { font-size: 2rem; margin-bottom: 10px; }
        .info-value { font-size: 1.5rem; font-weight: bold; color: #e67e22; margin-bottom: 5px; }
        .info-label { color: #666; font-size: 14px; }
        
        .status-badge {
            padding: 10px 20px; border-radius: 25px; font-size: 14px; font-weight: 600;
            text-transform: uppercase; text-align: center; margin-bottom: 20px;
        }
        .status-pendente { background: #fff3cd; color: #856404; }
        .status-aceito { background: #d1ecf1; color: #0c5460; }
        .status-preparando { background: #d4edda; color: #155724; }
        .status-saiu { background: #cce5ff; color: #004085; }
        .status-entregue { background: #d1e7dd; color: #0f5132; }
        .status-cancelado { background: #f8d7da; color: #721c24; }
        
        .items-list { margin-bottom: 30px; }
        .item-row { display: flex; justify-content: space-between; align-items: center;
            padding: 15px 0; border-bottom: 1px solid #f0f0f0; }
        .item-row:last-child { border-bottom: none; }
        .item-info { display: flex; align-items: center; gap: 15px; }
        .item-quantity { background: #e67e22; color: white; width: 30px; height: 30px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 14px; font-weight: bold; }
        .item-name { font-weight: 600; color: #333; }
        .item-price { color: #27ae60; font-weight: 600; }
        
        .order-summary { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 30px; }
        .summary-row { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .summary-row:last-child { margin-bottom: 0; border-top: 1px solid #e1e5e9;
            padding-top: 10px; font-weight: bold; font-size: 1.2rem; }
        
        .order-actions { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
        .action-btn { padding: 15px 25px; border: none; border-radius: 25px; cursor: pointer;
            font-size: 16px; font-weight: 600; transition: all 0.3s ease; min-width: 150px; }
        .btn-aceitar { background: #27ae60; color: white; }
        .btn-aceitar:hover { background: #229954; }
        .btn-aceitar:disabled { background: #95a5a6; cursor: not-allowed; }
        .btn-rejeitar { background: #e74c3c; color: white; }
        .btn-rejeitar:hover { background: #c0392b; }
        .btn-rejeitar:disabled { background: #95a5a6; cursor: not-allowed; }
        .btn-preparar { background: #f39c12; color: white; }
        .btn-preparar:hover { background: #e67e22; }
        .btn-preparar:disabled { background: #95a5a6; cursor: not-allowed; }
        .btn-pronto { background: #3498db; color: white; }
        .btn-pronto:hover { background: #2980b9; }
        .btn-pronto:disabled { background: #95a5a6; cursor: not-allowed; }
        
        .client-info { background: #e8f5e8; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .client-info h3 { color: #27ae60; margin-bottom: 15px; }
        .client-detail { margin-bottom: 10px; }
        .client-label { font-weight: 600; color: #333; }
        
        .message { padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center; }
        .message.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .message.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        
        .loading { text-align: center; padding: 40px; color: #666; }
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #e67e22;
            border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;
            margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        @media (max-width: 768px) { .order-info { grid-template-columns: 1fr; }
            .order-actions { flex-direction: column; align-items: center; }
            .action-btn { width: 100%; max-width: 300px; } }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <button class="back-btn" onclick="voltarParaPedidos()">‚Üê Voltar</button>
            <div class="title">üìã Detalhes do Pedido</div>
        </div>
    </header>

    <main class="main">
        <div id="order-container">
            <div class="loading">
                <div class="spinner"></div>
                <div>Carregando detalhes do pedido...</div>
            </div>
        </div>
    </main>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "sua-api-key", authDomain: "seu-projeto.firebaseapp.com",
            projectId: "seu-projeto", storageBucket: "seu-projeto.appspot.com",
            messagingSenderId: "123456789", appId: "seu-app-id"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        let pedidoAtual = null;

        document.addEventListener('DOMContentLoaded', function() {
            verificarAutenticacao();
        });

        function verificarAutenticacao() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    db.collection('usuarios').doc(user.uid).get().then((doc) => {
                        if (doc.exists && doc.data().tipo === 'restaurante') {
                            currentUser = { uid: user.uid, email: user.email, ...doc.data() };
                            carregarPedido();
                        } else {
                            window.location.href = 'cadastro_login_restaurante.html';
                        }
                    });
                } else {
                    window.location.href = 'cadastro_login_restaurante.html';
                }
            });
        }

        async function carregarPedido() {
            const pedidoId = localStorage.getItem('pedidoId');
            if (!pedidoId) {
                mostrarErro('ID do pedido n√£o encontrado');
                return;
            }

            try {
                const pedidoDoc = await db.collection('pedidos').doc(pedidoId).get();
                if (!pedidoDoc.exists) {
                    mostrarErro('Pedido n√£o encontrado');
                    return;
                }

                pedidoAtual = { id: pedidoDoc.id, ...pedidoDoc.data() };
                exibirPedido();
            } catch (error) {
                console.error('Erro ao carregar pedido:', error);
                mostrarErro('Erro ao carregar pedido');
            }
        }

        function exibirPedido() {
            if (!pedidoAtual) return;

            const container = document.getElementById('order-container');
            container.innerHTML = `
                <div class="order-section">
                    <div class="section-header">
                        <h2>Pedido #${pedidoAtual.id.slice(-6)}</h2>
                        <p>${new Date(pedidoAtual.dataPedido.toDate()).toLocaleString('pt-BR')}</p>
                    </div>
                    <div class="section-content">
                        <div class="status-badge status-${pedidoAtual.status}">
                            ${getStatusNome(pedidoAtual.status)}
                        </div>
                        
                        <div class="order-info">
                            <div class="info-item">
                                <div class="info-icon">üë§</div>
                                <div class="info-value">${pedidoAtual.clienteNome}</div>
                                <div class="info-label">Cliente</div>
                            </div>
                            <div class="info-item">
                                <div class="info-icon">üì±</div>
                                <div class="info-value">${pedidoAtual.clienteTelefone}</div>
                                <div class="info-label">Telefone</div>
                            </div>
                            <div class="info-item">
                                <div class="info-icon">üçΩÔ∏è</div>
                                <div class="info-value">${pedidoAtual.itens.length}</div>
                                <div class="info-label">Itens</div>
                            </div>
                            <div class="info-item">
                                <div class="info-icon">üí∞</div>
                                <div class="info-value">R$ ${pedidoAtual.total.toFixed(2)}</div>
                                <div class="info-label">Total</div>
                            </div>
                        </div>
                        
                        <div class="client-info">
                            <h3>üìç Endere√ßo de Entrega</h3>
                            <div class="client-detail">
                                <span class="client-label">Endere√ßo:</span> ${pedidoAtual.clienteEndereco}
                            </div>
                            <div class="client-detail">
                                <span class="client-label">Forma de Pagamento:</span> ${getFormaPagamento(pedidoAtual.formaPagamento)}
                            </div>
                        </div>
                        
                        <div class="items-list">
                            <h3>üçΩÔ∏è Itens do Pedido</h3>
                            ${pedidoAtual.itens.map(item => `
                                <div class="item-row">
                                    <div class="item-info">
                                        <div class="item-quantity">${item.quantidade}</div>
                                        <div class="item-name">${item.nome}</div>
                                    </div>
                                    <div class="item-price">R$ ${(item.preco * item.quantidade).toFixed(2)}</div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="order-summary">
                            <div class="summary-row">
                                <span>Subtotal:</span>
                                <span>R$ ${pedidoAtual.subtotal.toFixed(2)}</span>
                            </div>
                            <div class="summary-row">
                                <span>Taxa de Entrega:</span>
                                <span>R$ ${pedidoAtual.taxaEntrega.toFixed(2)}</span>
                            </div>
                            <div class="summary-row">
                                <span>Total:</span>
                                <span>R$ ${pedidoAtual.total.toFixed(2)}</span>
                            </div>
                        </div>
                        
                        <div class="order-actions">
                            ${getBotoesAcao(pedidoAtual.status, pedidoAtual.id)}
                        </div>
                    </div>
                </div>
            `;
        }

        function getStatusNome(status) {
            const statusMap = {
                'pendente': 'Pendente',
                'aceito': 'Aceito',
                'preparando': 'Preparando',
                'saiu': 'Saiu para Entrega',
                'entregue': 'Entregue',
                'cancelado': 'Cancelado'
            };
            return statusMap[status] || status;
        }

        function getFormaPagamento(forma) {
            const formas = {
                'pix': 'PIX',
                'card': 'Cart√£o',
                'dinheiro': 'Dinheiro'
            };
            return formas[forma] || forma;
        }

        function getBotoesAcao(status, pedidoId) {
            switch(status) {
                case 'pendente':
                    return `
                        <button class="action-btn btn-aceitar" onclick="atualizarStatus('${pedidoId}', 'aceito')">
                            ‚úÖ Aceitar Pedido
                        </button>
                        <button class="action-btn btn-rejeitar" onclick="atualizarStatus('${pedidoId}', 'cancelado')">
                            ‚ùå Rejeitar Pedido
                        </button>
                    `;
                case 'aceito':
                    return `
                        <button class="action-btn btn-preparar" onclick="atualizarStatus('${pedidoId}', 'preparando')">
                            üî• Come√ßar a Preparar
                        </button>
                    `;
                case 'preparando':
                    return `
                        <button class="action-btn btn-pronto" onclick="atualizarStatus('${pedidoId}', 'saiu')">
                            üöÄ Pedido Pronto
                        </button>
                    `;
                default:
                    return `<p style="text-align: center; color: #666; padding: 20px;">Pedido ${getStatusNome(status).toLowerCase()}</p>`;
            }
        }

        async function atualizarStatus(pedidoId, novoStatus) {
            try {
                await db.collection('pedidos').doc(pedidoId).update({
                    status: novoStatus,
                    dataAtualizacao: new Date()
                });
                
                mostrarMensagem(`Pedido ${novoStatus} com sucesso!`, 'success');
                setTimeout(() => {
                    window.location.href = 'pedidos_restaurante.html';
                }, 2000);
                
            } catch (error) {
                console.error('Erro ao atualizar status:', error);
                mostrarMensagem('Erro ao atualizar status', 'error');
            }
        }

        function mostrarMensagem(texto, tipo) {
            const mensagem = document.createElement('div');
            mensagem.className = `message ${tipo}`;
            mensagem.textContent = texto;
            document.querySelector('.main').insertBefore(mensagem, document.querySelector('.main').firstChild);
            setTimeout(() => mensagem.remove(), 5000);
        }

        function mostrarErro(texto) {
            const container = document.getElementById('order-container');
            container.innerHTML = `
                <div class="order-section">
                    <div class="section-header">
                        <h2>‚ùå Erro</h2>
                    </div>
                    <div class="section-content">
                        <p style="text-align: center; color: #666; padding: 40px;">${texto}</p>
                        <div style="text-align: center;">
                            <button onclick="voltarParaPedidos()" class="action-btn btn-aceitar">
                                ‚Üê Voltar para Pedidos
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function voltarParaPedidos() {
            window.location.href = 'pedidos_restaurante.html';
        }
    </script>
</body>
</html>
